<?xml version="1.0" encoding="utf-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
    <Fragment>
        <Property Id="INSTALLDESKTOPSHORTCUT" Value="1" />
        <Property Id="INSTALLSTARTMENUSHORTCUT" Value="1" />

        <DirectoryRef Id="binFolder">
            <Component Id="Gallio.Icarus.exe" Guid="2a7e3285-c570-44fa-8132-cb6d22f2f7c0">
                <File Id="Gallio.Icarus.exe" Source="$(var.TargetDir)\bin\Gallio.Icarus.exe" KeyPath="yes" />
                <File Id="Gallio.Icarus.exe.config" Source="$(var.TargetDir)\bin\Gallio.Icarus.exe.config" />
            </Component>
            <Component Id="ICSharpCode.TextEditor.dll" Guid="7b12c1e0-c859-4ca8-a32a-b3e1f5059055">
                <File Id="ICSharpCode.TextEditor.dll" Source="$(var.TargetDir)\bin\ICSharpCode.TextEditor.dll" Assembly=".net" AssemblyApplication="Gallio.Icarus.exe" KeyPath="yes" />
            </Component>
            <Component Id="Aga.Controls.dll" Guid="3c58ac7a-fe23-4bd4-9bb4-1bd5c107ba89">
                <File Id="Aga.Controls.dll" Source="$(var.TargetDir)\bin\Aga.Controls.dll" Assembly=".net" AssemblyApplication="Gallio.Icarus.exe" KeyPath="yes" />
            </Component>
            <Component Id="WeifenLuo.WinFormsUI.Docking.dll" Guid="3B11B01F-71EB-4423-AC66-55CE8E6E30D9">
                <File Id="WeifenLuo.WinFormsUI.Docking.dll" Source="$(var.TargetDir)\bin\WeifenLuo.WinFormsUI.Docking.dll" Assembly=".net" AssemblyApplication="Gallio.Icarus.exe" KeyPath="yes" />
            </Component>
        </DirectoryRef>

        <Icon Id="Gallio.icon.exe" SourceFile="$(var.TargetDir)\bin\Gallio.Icarus.exe" />

        <DirectoryRef Id="GallioMenuFolder">
            <Component Id="Gallio.Icarus.MenuShortcut" Guid="24507684-a556-421e-8081-33be552794a2">
                <Condition>INSTALLSTARTMENUSHORTCUT</Condition>
                <CreateFolder />
                <RegistryKey Action="none" Root="HKCU" Key="Software\gallio.org\Gallio\[ProductVersion]">
                    <RegistryValue Name="ProductVersion" Value="[ProductVersion]" Type="string" KeyPath="yes" />
                </RegistryKey>
                <Shortcut Id="Gallio.Icarus.lnk" Name="Icarus GUI Test Runner" Icon="Gallio.icon.exe" IconIndex="0" Target="[#Gallio.Icarus.exe]" Directory="GallioMenuFolder" WorkingDirectory="binFolder" Advertise="no" Show="normal" />
                <RemoveFile Id="Gallio.Icarus.lnk" On="uninstall" Name="[Gallio.Icarus.lnk]" />
                <RemoveFolder Id="GallioMenuFolder" On="uninstall" />
            </Component>
        </DirectoryRef>

        <DirectoryRef Id="DesktopFolder">
            <Component Id="Gallio.Icarus.DesktopShortcut" Guid="0738b1ff-91a5-47cc-b130-5eb6cdee925d">
                <Condition>INSTALLDESKTOPSHORTCUT</Condition>
                <RegistryKey Action="none" Root="HKCU" Key="Software\gallio.org\Gallio\[ProductVersion]">
                    <RegistryValue Name="ProductVersion" Value="[ProductVersion]" Type="string" KeyPath="yes" />
                </RegistryKey>
                <Shortcut Id="Gallio.Icarus.Desktop.lnk" Name="Gallio Icarus" Icon="Gallio.icon.exe" IconIndex="0" Target="[#Gallio.Icarus.exe]" Directory="DesktopFolder" WorkingDirectory="binFolder" Advertise="no" Show="normal" />
                <RemoveFile Id="Gallio.Icarus.Desktop.lnk" On="uninstall" Name="[Gallio.Icarus.Desktop.lnk]" />
            </Component>
        </DirectoryRef>

        <Feature Id="feat_Gallio.Icarus" Title="Icarus (GUI Test Runner)" Level="1" Description="Installs the Gallio GUI-based test runner.">
            <ComponentRef Id="Gallio.Icarus.exe" />
            <ComponentRef Id="ICSharpCode.TextEditor.dll" />
            <ComponentRef Id="Aga.Controls.dll" />
            <ComponentRef Id="WeifenLuo.WinFormsUI.Docking.dll" />

            <ComponentRef Id="Gallio.Icarus.MenuShortcut" />
            <ComponentRef Id="Gallio.Icarus.DesktopShortcut" />
        </Feature>
    </Fragment>
</Wix>
